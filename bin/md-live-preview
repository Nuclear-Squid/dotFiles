#! /bin/env bash

# Deux arguments demandés :
# $1 => fichier .md à surveiller
# $2 => fichier .html, sortie de pandoc, ouvent dans firefox

TERM_WINDOW=$(xdotool getwindowfocus)

if [ $# -lt 2 ] || [ ! -f "$1" ]; then
	echo "Arrête d'être con"
	exit 1
fi

pandoc -s "$1" > "$2"
firefox "$2"
BROWSER_TAB=$(xdotool search --name "Mozilla Firefox")

while inotifywait -q "$1" > /dev/null; do
	pandoc -s "$1" > "$2"

	# Upate the browser tab
	xdotool windowactivate "$BROWSER_TAB"
	xdotool key F5
	xdotool windowactivate "$TERM_WINDOW"
done
